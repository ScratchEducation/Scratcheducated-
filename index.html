<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portal OS</title>
    <style>
        :root { --accent: #a29bfe; --glass: rgba(0, 0, 0, 0.8); }
        body, html { margin: 0; padding: 0; height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; background: #000; }
        
        #desktop {
            width: 100%; height: 100%;
            background: url('https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=1500') center/cover;
            transition: background 0.5s ease;
        }

        /* WINDOWS */
        .window {
            position: absolute; top: 10%; left: 10%;
            width: 400px; height: 300px; min-width: 200px; min-height: 150px;
            background: #1a1a1a; border-radius: 12px; display: none;
            flex-direction: column; overflow: hidden; z-index: 10;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1);
            resize: both; /* Native resizing */
        }
        
        .title-bar { padding: 10px; background: #222; color: white; display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none; }
        .win-btn { border: none; width: 25px; height: 25px; border-radius: 50%; color: white; cursor: pointer; background: #ff5f57; font-size: 14px; }
        
        .content { flex-grow: 1; background: #000; position: relative; width: 100%; height: 100%; }
        iframe { width: 100%; height: 100%; border: none; pointer-events: auto; }
        
        /* Iframe overlay to allow dragging over them */
        .drag-overlay { position: absolute; inset: 0; display: none; z-index: 5; }

        /* NOTEPAD & SETTINGS */
        #note-text { width: 100%; height: 100%; background: #222; color: #fff; border: none; padding: 15px; box-sizing: border-box; font-size: 16px; outline: none; }
        .settings-grid { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; color: white; }
        .wp-thumb { width: 100%; height: 60px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; }
        .wp-thumb:hover { border-color: var(--accent); }

        /* TASKBAR */
        .taskbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            height: 65px; background: var(--glass); backdrop-filter: blur(20px);
            display: flex; align-items: center; gap: 15px; padding: 0 20px; border-radius: 20px; z-index: 1000;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .tb-icon { font-size: 30px; cursor: pointer; transition: transform 0.1s; }
    </style>
</head>
<body>

<div id="desktop">
    <div id="win-mc" class="window"><div class="title-bar"><span>Minecraft</span><button class="win-btn" onclick="cls('win-mc')">√ó</button></div><div class="content"><div class="drag-overlay"></div><iframe id="ifr-mc"></iframe></div></div>
    
    <div id="win-gd" class="window"><div class="title-bar"><span>Geometry Dash</span><button class="win-btn" onclick="cls('win-gd')">√ó</button></div><div class="content"><div class="drag-overlay"></div><iframe id="ifr-gd"></iframe></div></div>

    <div id="win-note" class="window"><div class="title-bar"><span>Notepad</span><button class="win-btn" onclick="cls('win-note')">√ó</button></div><div class="content"><textarea id="note-text" placeholder="Type here... contents save automatically."></textarea></div></div>

    <div id="win-set" class="window"><div class="title-bar"><span>Settings</span><button class="win-btn" onclick="cls('win-set')">√ó</button></div><div class="content">
        <div class="settings-grid">
            <img src="https://images.unsplash.com/photo-1477346611705-65d1883cee1e?w=200" class="wp-thumb" onclick="setWP(this.src)">
            <img src="https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=200" class="wp-thumb" onclick="setWP(this.src)">
            <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=200" class="wp-thumb" onclick="setWP(this.src)">
            <img src="https://images.unsplash.com/photo-1434725039720-aaad6dd32dee?w=200" class="wp-thumb" onclick="setWP(this.src)">
        </div>
    </div></div>

    <div class="taskbar">
        <div class="tb-icon" onclick="opn('win-mc', 'https://classic.minecraft.net/')">‚õèÔ∏è</div>
        <div class="tb-icon" onclick="opn('win-gd', 'https://geometrylitepc.io')">üî•</div>
        <div class="tb-icon" onclick="opn('win-note')">üìù</div>
        <div class="tb-icon" onclick="opn('win-set')">‚öôÔ∏è</div>
        <div class="tb-icon" onclick="window.close(); alert('Tab closing requested!')">üî¥</div>
    </div>
</div>

<script>
    // --- OPEN / CLOSE ---
    function opn(id, url) {
        const win = document.getElementById(id);
        win.style.display = 'flex';
        win.style.zIndex = Date.now();
        if(url) {
            const ifr = win.querySelector('iframe');
            if(!ifr.src) ifr.src = url;
        }
    }
    function cls(id) { document.getElementById(id).style.display = 'none'; }

    // --- WALLPAPER ---
    function setWP(url) { 
        const cleanUrl = url.split('?')[0]; // Get high res version
        document.getElementById('desktop').style.backgroundImage = `url('${cleanUrl}')`; 
    }

    // --- NOTEPAD SAVING ---
    const note = document.getElementById('note-text');
    note.value = localStorage.getItem('portal_note') || "";
    note.oninput = () => localStorage.setItem('portal_note', note.value);

    // --- DRAGGING LOGIC ---
    document.querySelectorAll('.window').forEach(win => {
        const header = win.querySelector('.title-bar');
        const overlay = win.querySelector('.drag-overlay');
        let isDragging = false, offset = [0,0];

        header.onmousedown = (e) => {
            isDragging = true;
            offset = [win.offsetLeft - e.clientX, win.offsetTop - e.clientY];
            win.style.zIndex = Date.now();
            if(overlay) overlay.style.display = 'block'; // Stop iframe from stealing mouse
        };

        document.onmousemove = (e) => {
            if (!isDragging) return;
            win.style.left = (e.clientX + offset[0]) + 'px';
            win.style.top = (e.clientY + offset[1]) + 'px';
        };

        document.onmouseup = () => {
            isDragging = false;
            if(overlay) overlay.style.display = 'none';
        };
        
        // Mobile Support
        header.ontouchstart = (e) => {
            isDragging = true;
            const t = e.touches[0];
            offset = [win.offsetLeft - t.clientX, win.offsetTop - t.clientY];
            win.style.zIndex = Date.now();
            if(overlay) overlay.style.display = 'block';
        };
        header.ontouchmove = (e) => {
            if (!isDragging) return;
            const t = e.touches[0];
            win.style.left = (t.clientX + offset[0]) + 'px';
            win.style.top = (t.clientY + offset[1]) + 'px';
        };
        header.ontouchend = () => {
            isDragging = false;
            if(overlay) overlay.style.display = 'none';
        };
    });
</script>
</body>
</html>

